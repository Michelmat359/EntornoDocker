version: '3.7'

volumes:
  php:
  # mysql:
  # composer:

networks:
  backend:
    driver: bridge

services:
  php:
    container_name: ${COMPOSE_PROJECT_NAME:-template}.php
    build:
      context: ./docker/php
      dockerfile: Dockerfile
    ports:
      - "80:80"
    environment:
      XDEBUG_CONFIG: remote_host=${host_docker_internal:-host.docker.internal}
      PHP_IDE_CONFIG: serverName=phpstorm
#      APP_NAME: Mobilefleet
#      APP_ENV: production
      # APP_KEY: base64:mMJ/1wS4vzkGGsgmzbE+MmRxRzvfTBPdubNAVFvhl6w=
#      APP_DEBUG: 'true'
#      APP_LOG_LEVEL: debug
#      APP_URL: http://localhost.mobilefleet
#      DB_CONNECTION: mysql
      # DB_HOST: cursos.mysql
      # DB_PORT: 3306
      # DB_DATABASE: cursos-back
      # DB_USERNAME: root
      # DB_PASSWORD: rootpassword
#      BROADCAST_DRIVER: log
#      CACHE_DRIVER: file
#      SESSION_DRIVER: file
#      SESSION_LIFETIME: 120
#      QUEUE_DRIVER: sync
#      REDIS_HOST: 127.0.0.1
#      REDIS_PASSWORD: null
#      REDIS_PORT: 6379
#      MAIL_DRIVER: smtp
#      MAIL_HOST: smtp.mailtrap.io
#      MAIL_PORT: 2525
#      MAIL_USERNAME: null
#      MAIL_PASSWORD: null
#      MAIL_ENCRYPTION: null
    volumes:
      - ./src:/var/www/html
      - ./docker/php/apache:/etc/apache2/sites-available/
    networks:
      - backend
  mysql:
      image: mysql:5.6
      container_name: ${COMPOSE_PROJECT_NAME:-template}.mysql
      ports:
         - "3306:3306"
      volumes:
          - ./docker/mysql/data:/var/lib/mysql
          - ./docker/mysql/bootstrap.sql:/docker-entrypoint-initdb.d/bootstrap.sql
      restart: always
      environment:
        MYSQL_ROOT_PASSWORD: rootpassword
      networks:
        - backend
  ### comando para usar composer:
  # docker-compose run ${COMPOSE_PROJECT_NAME}.composer composer install
  ### OJO! puede fallar si composer requiere alguna libreria no estandar de php..
  composer:
    container_name: ${COMPOSE_PROJECT_NAME:-template}.composer
    image: composer:latest
    volumes:
      - ./src:/var/www/html
    working_dir: /var/www/html


